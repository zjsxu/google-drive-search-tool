# 实施计划

- [x] 1. 设置项目结构和核心接口
  - 创建Google Apps Script项目目录结构
  - 定义核心数据模型接口（SearchResult, FileMatch, SearchConfiguration）
  - 设置Drive API服务权限和配置
  - 创建基础的测试框架结构
  - _需求: 1.1, 4.3_

- [x] 2. 实现搜索控制器核心逻辑
  - [x] 2.1 创建SearchController类和输入验证
    - 实现SearchController类的基本结构
    - 添加文件夹ID和关键词的输入验证逻辑
    - 实现搜索初始化方法
    - _需求: 1.1, 5.3_

  - [x] 2.2 为搜索控制器编写属性测试
    - **属性 1: 搜索执行完整性**
    - **验证: 需求 1.1**

  - [x] 2.3 为输入验证编写属性测试
    - **属性 11: 输入验证**
    - **验证: 需求 5.3**

- [x] 3. 实现Drive API查询和内容匹配
  - [x] 3.1 创建ContentMatcher类
    - 实现Drive API查询语法构建
    - 添加文件访问权限验证
    - 实现全文搜索查询逻辑
    - _需求: 1.2, 1.3, 5.2_

  - [x] 3.2 实现多文件类型支持
    - 添加对Google Docs、PDF、Word、TXT、Google Sheets的支持
    - 实现文件类型检测和处理逻辑
    - _需求: 1.2_

  - [x] 3.3 为文件类型支持编写属性测试
    - **属性 2: 文件类型支持完整性**
    - **验证: 需求 1.2**

  - [x] 3.4 为搜索准确性编写属性测试
    - **属性 3: 搜索准确性**
    - **验证: 需求 1.3**

  - [x] 3.5 为搜索范围限制编写属性测试
    - **属性 10: 搜索范围限制**
    - **验证: 需求 5.1, 5.2, 5.4**

- [x] 4. 实现递归文件夹遍历
  - [x] 4.1 创建FolderTraverser类
    - 实现递归文件夹遍历逻辑
    - 添加子文件夹获取和处理方法
    - 实现路径信息收集功能
    - _需求: 2.1, 2.2, 2.3, 2.4_

  - [x] 4.2 为递归遍历编写属性测试
    - **属性 5: 递归遍历完整性**
    - **验证: 需求 2.1, 2.2, 2.3**

- [x] 5. 实现异常处理和错误管理
  - [x] 5.1 创建ExceptionHandler类
    - 实现权限异常处理逻辑
    - 添加网络超时重试机制
    - 实现配额限制处理策略
    - 添加有意义的错误信息生成
    - _需求: 3.1, 3.2, 3.3, 3.4_

  - [x] 5.2 为异常处理编写属性测试
    - **属性 6: 异常处理稳定性**
    - **验证: 需求 3.1, 3.3**

  - [x] 5.3 为错误信息编写属性测试
    - **属性 7: 错误信息有效性**
    - **验证: 需求 3.4**

- [x] 6. 实现结果收集和输出格式化
  - [x] 6.1 创建ResultCollector类
    - 实现搜索结果收集逻辑
    - 添加结果格式化方法
    - 实现控制台日志输出功能
    - _需求: 1.4, 1.5, 4.4_

  - [x] 6.2 实现Google Sheet输出功能
    - 添加Google Sheet创建和写入逻辑
    - 实现表格格式化（文件名、链接、路径列）
    - 添加批量数据写入优化
    - _需求: 4.5_

  - [x] 6.3 为结果完整性编写属性测试
    - **属性 4: 结果完整性**
    - **验证: 需求 1.4, 1.5, 2.4**

  - [ ]* 6.4 为输出格式编写属性测试
    - **属性 9: 输出格式支持**
    - **验证: 需求 4.4, 4.5**

- [x] 7. 实现性能优化和增量搜索
  - [x] 7.1 添加执行时间监控
    - 实现执行时间跟踪机制
    - 添加接近超时限制的检测
    - _需求: 4.1_

  - [x] 7.2 实现增量搜索策略
    - 添加文件数量阈值检测
    - 实现搜索进度保存和恢复
    - 添加分批处理逻辑
    - _需求: 4.2_

  - [ ]* 7.3 为增量搜索编写属性测试
    - **属性 8: 增量搜索策略**
    - **验证: 需求 4.2**

- [x] 8. 集成所有组件并创建主入口
  - [x] 8.1 创建主搜索函数
    - 集成所有核心组件
    - 实现完整的搜索工作流程
    - 添加用户友好的接口函数
    - _需求: 1.1, 1.2, 1.3, 1.4, 1.5_

  - [x] 8.2 添加配置管理
    - 实现搜索配置参数管理
    - 添加默认设置和用户自定义选项
    - _需求: 4.4, 4.5_

  - [ ]* 8.3 编写集成测试
    - 创建端到端搜索流程测试
    - 验证所有组件协同工作
    - 测试不同配置组合的正确性

- [x] 9. 检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户

- [x] 10. 创建用户界面和文档
  - [x] 10.1 创建Google Apps Script Web应用界面
    - 实现简单的HTML表单界面
    - 添加文件夹ID和关键词输入字段
    - 实现搜索结果显示功能
    - _需求: 1.1_

  - [x] 10.2 添加使用说明和示例
    - 创建详细的使用文档
    - 添加常见用例和示例代码
    - 包含权限设置和API启用指南
    - _需求: 4.3_

- [x] 11. 最终检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户